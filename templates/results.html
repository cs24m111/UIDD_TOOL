<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compliance Results - {{ platform_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <style>
        .progress-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto;
        }
        .evidence-box {
            background-color: #f8f9fa;
            border-left: 4px solid #0d6efd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        .rule-card {
            transition: all 0.3s ease;
        }
        .rule-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        @media print {
            .no-print { display: none; }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark no-print">
        <div class="container">
            <a href="/" class="navbar-brand">
                <i class="fas fa-gavel me-2"></i>
                IT Rules 2021 Compliance Checker
            </a>
            <div>
                <button onclick="window.print()" class="btn btn-outline-light btn-sm">
                    <i class="fas fa-print me-2"></i>Print Report
                </button>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        {% if error %}
        <!-- Error Display -->
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="alert alert-danger" role="alert">
                    <h4 class="alert-heading">
                        <i class="fas fa-exclamation-triangle me-2"></i>Error
                    </h4>
                    <p>{{ error }}</p>
                    <hr>
                    <p class="mb-0">
                        <a href="/" class="btn btn-primary">
                            <i class="fas fa-arrow-left me-2"></i>Go Back
                        </a>
                    </p>
                </div>
            </div>
        </div>
        {% else %}
        <!-- Results Display -->

        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold">Compliance Analysis Report</h1>
            <p class="lead text-muted">{{ platform_name }}</p>
            <p class="text-muted small">Generated on {{ timestamp }}</p>
        </div>

        <!-- Overall Score Card -->
        <div class="row mb-5">
            <div class="col-lg-12">
                <div class="card shadow-lg border-0">
                    <div class="card-body text-center p-5">
                        <h3 class="mb-4">Overall Compliance Score</h3>
                        <div class="progress-circle bg-{{ status_color }} bg-opacity-25 border border-{{ status_color }} border-3">
                            {{ "%.1f"|format(overall_score) }}%
                        </div>
                        <h4 class="mt-4 text-{{ status_color }}">{{ overall_status }}</h4>
                        <p class="text-muted mt-3">{{ summary }}</p>

                        <!-- URLs Analyzed -->
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <small class="text-muted d-block">Privacy Policy</small>
                                <a href="{{ privacy_policy_url }}" target="_blank" class="text-decoration-none">
                                    <i class="fas fa-external-link-alt me-1"></i>
                                    {{ privacy_policy_url[:50] }}...
                                </a>
                            </div>
                            <div class="col-md-6">
                                <small class="text-muted d-block">Homepage</small>
                                <a href="{{ homepage_url }}" target="_blank" class="text-decoration-none">
                                    <i class="fas fa-external-link-alt me-1"></i>
                                    {{ homepage_url[:50] }}...
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Image Analysis Results (if available) -->
        {% if image_analysis and image_analysis.success %}
        <div class="row mb-5">
            <div class="col-lg-12">
                <div class="card shadow border-0">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-image me-2"></i>
                            AI Label Detection - Homepage Image Analysis
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Detection Results:</h6>
                                {% if image_analysis.has_label %}
                                    <p class="text-success">
                                        <i class="fas fa-check-circle me-2"></i>
                                        AI label detected in image
                                    </p>
                                {% else %}
                                    <p class="text-warning">
                                        <i class="fas fa-exclamation-circle me-2"></i>
                                        No AI label detected
                                    </p>
                                {% endif %}

                                <p>
                                    <strong>Label Coverage:</strong>
                                    {{ "%.2f"|format(image_analysis.label_coverage) }}%
                                </p>

                                {% if image_analysis.complies_with_10_percent %}
                                    <p class="text-success">
                                        <i class="fas fa-check-circle me-2"></i>
                                        Meets 10% coverage requirement
                                    </p>
                                {% else %}
                                    <p class="text-danger">
                                        <i class="fas fa-times-circle me-2"></i>
                                        Does not meet 10% coverage requirement
                                    </p>
                                {% endif %}
                            </div>

                            <div class="col-md-6">
                                <h6>Technical Details:</h6>

                                {% if image_analysis.metadata_check.has_ai_indicator %}
                                <div class="alert alert-success py-2">
                                    <small>
                                        <i class="fas fa-check me-2"></i>
                                        AI indicators found in image metadata
                                    </small>
                                </div>
                                {% endif %}

                                {% if image_analysis.visual_analysis.has_watermark %}
                                <div class="alert alert-info py-2">
                                    <small>
                                        <i class="fas fa-info-circle me-2"></i>
                                        {{ image_analysis.visual_analysis.watermark_regions|length }} watermark region(s) detected
                                    </small>
                                </div>
                                {% endif %}

                                {% if image_analysis.ocr_results %}
                                <div class="alert alert-info py-2">
                                    <small>
                                        <i class="fas fa-font me-2"></i>
                                        Text detected in image (OCR)
                                    </small>
                                </div>
                                {% endif %}

                                <p class="small text-muted mt-2">
                                    Image analyzed: <a href="{{ image_analysis.image_url }}" target="_blank">View Image</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Individual Rule Results -->
        <div class="row mb-5">
            <div class="col-lg-12">
                <h3 class="mb-4">
                    <i class="fas fa-list-check me-2"></i>
                    Detailed Rule Analysis
                </h3>
            </div>
        </div>

        {% for rule_key, rule_data in rules.items() %}
        <div class="row mb-4">
            <div class="col-lg-12">
                <div class="card rule-card shadow-sm border-0">
                    <div class="card-header {% if rule_data.status == 'Pass' %}bg-success{% elif rule_data.status == 'Partial' %}bg-warning{% else %}bg-danger{% endif %} text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                {% if rule_data.status == 'Pass' %}
                                    <i class="fas fa-check-circle me-2"></i>
                                {% elif rule_data.status == 'Partial' %}
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                {% else %}
                                    <i class="fas fa-times-circle me-2"></i>
                                {% endif %}
                                {{ rule_data.rule }}
                            </h5>
                            <span class="badge bg-white text-dark fs-6">
                                {{ "%.0f"|format(rule_data.score) }}%
                            </span>
                        </div>
                    </div>
                    <div class="card-body">
                        <h6 class="text-muted mb-3">{{ rule_data.description }}</h6>

                        <div class="mb-3">
                            <strong>Status:</strong>
                            <span class="badge {% if rule_data.status == 'Pass' %}bg-success{% elif rule_data.status == 'Partial' %}bg-warning{% else %}bg-danger{% endif %}">
                                {{ rule_data.status }}
                            </span>
                        </div>

                        <!-- Findings -->
                        <div class="mb-3">
                            <strong>Findings:</strong>
                            <ul class="mt-2">
                                {% for finding in rule_data.findings %}
                                <li>{{ finding }}</li>
                                {% endfor %}
                            </ul>
                        </div>

                        <!-- Evidence -->
                        {% if rule_data.evidence %}
                        <div class="mb-3">
                            <strong>Evidence from Policy:</strong>
                            {% for evidence in rule_data.evidence %}
                            <div class="evidence-box">
                                "{{ evidence }}"
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- Sub-requirements (for Rule 3.3 and 4.1A) -->
                        {% if rule_data.sub_requirements %}
                        <div class="mb-3">
                            <strong>Sub-Requirements:</strong>
                            <ul class="list-group mt-2">
                                {% for req_key, req_value in rule_data.sub_requirements.items() %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ req_key.replace('_', ' ').title() }}
                                    {% if req_value %}
                                        <span class="badge bg-success">Met</span>
                                    {% else %}
                                        <span class="badge bg-danger">Not Met</span>
                                    {% endif %}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        <!-- Recommendation -->
                        <div class="alert {% if rule_data.status == 'Pass' %}alert-success{% else %}alert-warning{% endif %} mb-0">
                            <strong>
                                <i class="fas fa-lightbulb me-2"></i>
                                Recommendation:
                            </strong>
                            {{ rule_data.recommendation }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        <!-- Action Buttons -->
        <div class="row mb-5 no-print">
            <div class="col-lg-12 text-center">
                <a href="/" class="btn btn-primary btn-lg me-3">
                    <i class="fas fa-arrow-left me-2"></i>
                    Check Another Platform
                </a>
                <button onclick="window.print()" class="btn btn-outline-secondary btn-lg">
                    <i class="fas fa-print me-2"></i>
                    Print Report
                </button>
            </div>
        </div>

        <!-- Summary Recommendations -->
        <div class="row mb-5">
            <div class="col-lg-12">
                <div class="card border-0 shadow">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-clipboard-list me-2"></i>
                            Executive Summary
                        </h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Platform:</strong> {{ platform_name }}</p>
                        <p><strong>Overall Compliance:</strong> {{ overall_status }} ({{ "%.2f"|format(overall_score) }}%)</p>

                        {% if overall_score >= 70 %}
                        <p class="text-success">
                            This platform demonstrates good compliance with IT Rules 2021 amendments regarding synthetically generated information.
                            Continue monitoring and updating policies as regulations evolve.
                        </p>
                        {% elif overall_score >= 40 %}
                        <p class="text-warning">
                            This platform shows partial compliance. Review the recommendations for each failed or partially compliant rule to achieve full compliance.
                            Priority should be given to rules with the lowest scores.
                        </p>
                        {% else %}
                        <p class="text-danger">
                            This platform requires significant updates to achieve compliance with IT Rules 2021 amendments.
                            Immediate action is recommended to address the deficiencies identified in this report.
                            Consult with legal counsel to implement necessary changes.
                        </p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        {% endif %}
    </div>

    <footer class="bg-dark text-white text-center py-4 mt-5 no-print">
        <div class="container">
            <p class="mb-0">
                IT Rules 2021 Compliance Checker |
                Automated analysis for informational purposes only - Not legal advice
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
